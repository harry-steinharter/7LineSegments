# List all CSV files in the directory
file_list <- list.files(path = "../Outputs/", pattern = "\\.csv$", full.names = TRUE)
# Read and bind all CSV files into one data frame
all_data <- do.call(rbind, lapply(file_list, read.csv))
df <- all_data %>%  subset(Reaction_Time < 99)
df %<>% subset(Correct_Response != "None")
df$Correct_Response %<>% as.numeric()
#### Perform transformations ####
if (TRUE){
df$TC_c <- scale(df$Target_Contrast,scale=F) %>% c()
df$TC_michelson <- toCandela(df$Target_Contrast) %>% MC()
df$TC_michelson_c <- scale(df$TC_michelson,scale=F) %>% c()
df$FCfar_c <- scale(df$FCfar,scale=F) %>% c()
df$FCfar_michelson <- toCandela(df$FCfar) %>% MC()
df$FCfar_michelson_c <- scale(df$FCfar_michelson,scale=F) %>% c()
df$FCmed_c <- scale(df$FCmed,scale=F) %>% c()
df$FCmed_michelson <- toCandela(df$FCmed) %>% MC()
df$FCmed_michelson_c <- scale(df$FCmed_michelson,scale=F) %>% c()
df$FCclose_c <- scale(df$FCclose,scale=F) %>% c()
df$FCclose_michelson <- toCandela(df$FCclose) %>% MC()
df$FCclose_michelson_c <- scale(df$FCclose_michelson,scale=F) %>% c()
df$CondShort <- recode(df$Condition, recodes =
"'FarHighNarrow' = 'IN'; 'FarLowNarrow' = 'DN';
'FarHighWide' = 'IW'; 'FarLowWide' = 'DW';
'ThreeLinesControl' = 'Single'; 'Constant' = 'Constant'") %>% as.factor()
df %<>% mutate(TC_factor = ggplot2::cut_number(Target_Contrast, 3, labels = c("Low", "Medium", "High")))
}
#### Seperate ####
# Seperate into Real and Null Files
dfNull <- subset(df, endsWith(Condition,"_null"))
dfNull$CondShort %<>% droplevels()
dfReal <- subset(df, !endsWith(Condition,"_null"))
dfReal$CondShort %<>% droplevels()
dfReal %<>% categorize
#### Mutate real data ####
grandMean_real <- dfReal %>%
group_by(Participant_Number,CondShort) %>%
mutate(overall_mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,CondShort,overall_mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
meanByTC <- dfReal %>%
group_by(Participant_Number,CondShort,TC_factor) %>%
mutate(mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,TC_factor,CondShort,mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
rawIndividual <- dfReal %>%
group_by(Participant_Number,CondShort,Target_Contrast) %>%
mutate(performance = mean(Correct_Response), weights = n()) %>%
ungroup() %>%
distinct()
# Save the raw data
write.csv(rawIndividual,'glmDataRaw7LS.csv', row.names=FALSE)
write.csv(meanByTC,'subjectMeansByTCFactorRaw7LS.csv',row.names = FALSE)
write.csv(grandMean_real,'subjectMeansOverallRaw7LS.csv',row.names = FALSE)
library(magrittr)
library(dplyr)
MC <- function(L_max, L_min = 112.6482, nDigits=3){
# Function to find michelson contrast using L_min as the background luminance in PsychoPy units
michelson_contrast <- (L_max-L_min) / (L_max+L_min)
michelson_contrast %<>% round(nDigits)
return(michelson_contrast)
}
toCandela <- function(x, nDigits = 10){
CandelaPerMeterSquared <- (x * 112.417) + 112.6482
CandelaPerMeterSquared %<>% round(nDigits)
return(CandelaPerMeterSquared)
}
categorize <- function(df){
df %<>%mutate(
WidthGroup = case_when(
CondShort %in% c("Constant", "Single") ~ "controls",
CondShort %in% c('IW','DW') ~ "wide",
CondShort %in% c('IN','DN') ~ "narrow"
),
ExpectedGroup = case_when(
CondShort %in% c('Constant','IN','IW') ~ 'high',
CondShort %in% c('Single','DN','DW') ~ 'low'
)
)
return(df)
}
setwd('/Users/harrysteinharter/Documents/MSc/Timo Internship/7LineSegments/Analysis')
# List all CSV files in the directory
file_list <- list.files(path = "../Outputs/", pattern = "\\.csv$", full.names = TRUE)
# Read and bind all CSV files into one data frame
all_data <- do.call(rbind, lapply(file_list, read.csv))
df <- all_data %>%  subset(Reaction_Time < 99 & Correct_Response != 'None')
df$Correct_Response %<>% as.numeric()
#### Perform transformations ####
if (TRUE){
df$TC_c <- scale(df$Target_Contrast,scale=F) %>% c()
df$TC_michelson <- toCandela(df$Target_Contrast) %>% MC()
df$TC_michelson_c <- scale(df$TC_michelson,scale=F) %>% c()
df$FCfar_c <- scale(df$FCfar,scale=F) %>% c()
df$FCfar_michelson <- toCandela(df$FCfar) %>% MC()
df$FCfar_michelson_c <- scale(df$FCfar_michelson,scale=F) %>% c()
df$FCmed_c <- scale(df$FCmed,scale=F) %>% c()
df$FCmed_michelson <- toCandela(df$FCmed) %>% MC()
df$FCmed_michelson_c <- scale(df$FCmed_michelson,scale=F) %>% c()
df$FCclose_c <- scale(df$FCclose,scale=F) %>% c()
df$FCclose_michelson <- toCandela(df$FCclose) %>% MC()
df$FCclose_michelson_c <- scale(df$FCclose_michelson,scale=F) %>% c()
df$CondShort <- recode(df$Condition, recodes =
"'FarHighNarrow' = 'IN'; 'FarLowNarrow' = 'DN';
'FarHighWide' = 'IW'; 'FarLowWide' = 'DW';
'ThreeLinesControl' = 'Single'; 'Constant' = 'Constant'") %>% as.factor()
df %<>% mutate(TC_factor = ggplot2::cut_number(Target_Contrast, 3, labels = c("Low", "Medium", "High")))
}
#### Seperate ####
# Seperate into Real and Null Files
dfNull <- subset(df, endsWith(Condition,"_null"))
dfNull$CondShort %<>% droplevels()
dfReal <- subset(df, !endsWith(Condition,"_null"))
dfReal$CondShort %<>% droplevels()
dfReal %<>% categorize
#### Mutate real data ####
grandMean_real <- dfReal %>%
group_by(Participant_Number,CondShort) %>%
mutate(overall_mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,CondShort,overall_mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
meanByTC <- dfReal %>%
group_by(Participant_Number,CondShort,TC_factor) %>%
mutate(mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,TC_factor,CondShort,mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
rawIndividual <- dfReal %>%
group_by(Participant_Number,CondShort,Target_Contrast) %>%
mutate(performance = mean(Correct_Response), weights = n()) %>%
ungroup() %>%
distinct()
# Save the raw data
write.csv(rawIndividual,'glmDataRaw7LS.csv', row.names=FALSE)
write.csv(meanByTC,'subjectMeansByTCFactorRaw7LS.csv',row.names = FALSE)
write.csv(grandMean_real,'subjectMeansOverallRaw7LS.csv',row.names = FALSE)
df$Correct_Response %>% unique
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(dplyr)
library(car)
library(ggplot2)
library(ggpubr)
library(ggpattern)
library(ggsignif)
library(viridis)
library(xtable)
library(lme4)
library(lmerTest)
library(afex)
dfFull <- read.csv("glmDataRaw7LS.csv")
dfFull$CondShort %<>% as.factor
dfMean <- read.csv('subjectMeansByTCFactorRaw7LS.csv')
dfMean$CondShort %<>% as.factor
dfOverallMean <- read.csv('subjectMeansOverallRaw7LS.csv')
dfOverallMean$CondShort %<>% as.factor
#### Perform GLM ####
conds <- levels(dfFull$CondShort)
Formula <- "Correct_Response ~ TC_michelson_c * CondShort + (1|Participant_Number)"
Contrasts <- list(CondShort = contr.treatment(conds, which(conds == 'Single')))
dfFull$CondShort
library(magrittr)
library(dplyr)
MC <- function(L_max, L_min = 112.6482, nDigits=3){
# Function to find michelson contrast using L_min as the background luminance in PsychoPy units
michelson_contrast <- (L_max-L_min) / (L_max+L_min)
michelson_contrast %<>% round(nDigits)
return(michelson_contrast)
}
toCandela <- function(x, nDigits = 10){
CandelaPerMeterSquared <- (x * 112.417) + 112.6482
CandelaPerMeterSquared %<>% round(nDigits)
return(CandelaPerMeterSquared)
}
categorize <- function(df){
df %<>%mutate(
WidthGroup = case_when(
CondShort %in% c("Constant", "Single") ~ "controls",
CondShort %in% c('IW','DW') ~ "wide",
CondShort %in% c('IN','DN') ~ "narrow"
),
ExpectedGroup = case_when(
CondShort %in% c('Constant','IN','IW') ~ 'high',
CondShort %in% c('Single','DN','DW') ~ 'low'
)
)
return(df)
}
setwd('/Users/harrysteinharter/Documents/MSc/Timo Internship/7LineSegments/Analysis')
# List all CSV files in the directory
file_list <- list.files(path = "../Outputs/", pattern = "\\.csv$", full.names = TRUE)
# Read and bind all CSV files into one data frame
all_data <- do.call(rbind, lapply(file_list, read.csv))
df <- all_data %>%  subset(Reaction_Time < 99 & Correct_Response != 'None')
df$Correct_Response %<>% as.numeric()
#### Perform transformations ####
if (TRUE){
df$TC_c <- scale(df$Target_Contrast,scale=F) %>% c()
df$TC_michelson <- toCandela(df$Target_Contrast) %>% MC()
df$TC_michelson_c <- scale(df$TC_michelson,scale=F) %>% c()
df$FCfar_c <- scale(df$FCfar,scale=F) %>% c()
df$FCfar_michelson <- toCandela(df$FCfar) %>% MC()
df$FCfar_michelson_c <- scale(df$FCfar_michelson,scale=F) %>% c()
df$FCmed_c <- scale(df$FCmed,scale=F) %>% c()
df$FCmed_michelson <- toCandela(df$FCmed) %>% MC()
df$FCmed_michelson_c <- scale(df$FCmed_michelson,scale=F) %>% c()
df$FCclose_c <- scale(df$FCclose,scale=F) %>% c()
df$FCclose_michelson <- toCandela(df$FCclose) %>% MC()
df$FCclose_michelson_c <- scale(df$FCclose_michelson,scale=F) %>% c()
df %<>% mutate(TC_factor = ggplot2::cut_number(Target_Contrast, 3, labels = c("Low", "Medium", "High")))
}
#### Seperate ####
# Seperate into Real and Null Files
dfNull <- subset(df, endsWith(Condition,"_null"))
dfNull$CondShort %<>% droplevels()
library(magrittr)
library(dplyr)
MC <- function(L_max, L_min = 112.6482, nDigits=3){
# Function to find michelson contrast using L_min as the background luminance in PsychoPy units
michelson_contrast <- (L_max-L_min) / (L_max+L_min)
michelson_contrast %<>% round(nDigits)
return(michelson_contrast)
}
toCandela <- function(x, nDigits = 10){
CandelaPerMeterSquared <- (x * 112.417) + 112.6482
CandelaPerMeterSquared %<>% round(nDigits)
return(CandelaPerMeterSquared)
}
categorize <- function(df){
df %<>%mutate(
WidthGroup = case_when(
CondShort %in% c("Constant", "Single") ~ "controls",
CondShort %in% c('IW','DW') ~ "wide",
CondShort %in% c('IN','DN') ~ "narrow"
),
ExpectedGroup = case_when(
CondShort %in% c('Constant','IN','IW') ~ 'high',
CondShort %in% c('Single','DN','DW') ~ 'low'
)
)
return(df)
}
setwd('/Users/harrysteinharter/Documents/MSc/Timo Internship/7LineSegments/Analysis')
# List all CSV files in the directory
file_list <- list.files(path = "../Outputs/", pattern = "\\.csv$", full.names = TRUE)
# Read and bind all CSV files into one data frame
all_data <- do.call(rbind, lapply(file_list, read.csv))
df <- all_data %>%  subset(Reaction_Time < 99 & Correct_Response != 'None')
df$Correct_Response %<>% as.numeric()
#### Perform transformations ####
if (TRUE){
df$TC_c <- scale(df$Target_Contrast,scale=F) %>% c()
df$TC_michelson <- toCandela(df$Target_Contrast) %>% MC()
df$TC_michelson_c <- scale(df$TC_michelson,scale=F) %>% c()
df$FCfar_c <- scale(df$FCfar,scale=F) %>% c()
df$FCfar_michelson <- toCandela(df$FCfar) %>% MC()
df$FCfar_michelson_c <- scale(df$FCfar_michelson,scale=F) %>% c()
df$FCmed_c <- scale(df$FCmed,scale=F) %>% c()
df$FCmed_michelson <- toCandela(df$FCmed) %>% MC()
df$FCmed_michelson_c <- scale(df$FCmed_michelson,scale=F) %>% c()
df$FCclose_c <- scale(df$FCclose,scale=F) %>% c()
df$FCclose_michelson <- toCandela(df$FCclose) %>% MC()
df$FCclose_michelson_c <- scale(df$FCclose_michelson,scale=F) %>% c()
df %<>% mutate(TC_factor = ggplot2::cut_number(Target_Contrast, 3, labels = c("Low", "Medium", "High")))
}
#### Seperate ####
# Seperate into Real and Null Files
dfNull <- subset(df, endsWith(Condition,"_null"))
#dfNull$CondShort %<>% droplevels()
dfReal <- subset(df, !endsWith(Condition,"_null"))
dfReal$CondShort <- recode(dfReal$Condition, recodes =
"'FarHighNarrow' = 'IN'; 'FarLowNarrow' = 'DN';
'FarHighWide' = 'IW'; 'FarLowWide' = 'DW';
'ThreeLinesControl' = 'Single'; 'Constant' = 'Constant'") %>% as.factor()
dfReal$CondShort %>% levels
dfReal$CondShort %<>% droplevels()
dfReal %<>% categorize
#### Mutate real data ####
grandMean_real <- dfReal %>%
group_by(Participant_Number,CondShort) %>%
mutate(overall_mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,CondShort,overall_mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
meanByTC <- dfReal %>%
group_by(Participant_Number,CondShort,TC_factor) %>%
mutate(mean = mean(TC_michelson), weights = n()) %>%
select(Participant_Number,TC_factor,CondShort,mean,WidthGroup,ExpectedGroup) %>%
ungroup() %>%
distinct()
rawIndividual <- dfReal %>%
group_by(Participant_Number,CondShort,Target_Contrast) %>%
mutate(performance = mean(Correct_Response), weights = n()) %>%
ungroup() %>%
distinct()
# Save the raw data
write.csv(rawIndividual,'glmDataRaw7LS.csv', row.names=FALSE)
write.csv(meanByTC,'subjectMeansByTCFactorRaw7LS.csv',row.names = FALSE)
write.csv(grandMean_real,'subjectMeansOverallRaw7LS.csv',row.names = FALSE)
dfFull <- read.csv("glmDataRaw7LS.csv")
dfFull$CondShort %<>% as.factor
dfMean <- read.csv('subjectMeansByTCFactorRaw7LS.csv')
dfMean$CondShort %<>% as.factor
dfOverallMean <- read.csv('subjectMeansOverallRaw7LS.csv')
dfOverallMean$CondShort %<>% as.factor
#### Perform GLM ####
conds <- levels(dfFull$CondShort)
Formula <- "Correct_Response ~ TC_michelson_c * CondShort + (1|Participant_Number)"
Contrasts <- list(CondShort = contr.treatment(conds, which(conds == 'Single')))
model_glm <- glmer(
formula = Formula,
family = binomial(link='logit'),
data = dfFull,
contrasts = Contrasts,
weights = weights,
control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e5),
check.conv.grad = .makeCC("warning", tol = 0.005, relTol = NULL)),
)
dfFull$probability <- predict(model_glm,type='response', re.form = NA) # re.form=NA is fixed effects only. =NULL is both
# Likelihood Ratio test
#model_LRT <-  car::Anova(model_glm,type = 3, test.statistic = 'LR')
model_LRT <- afex::mixed(
formula = Formula,
data = dfFull,
family = binomial(link = 'logit'),
method = "LRT",  # Type III tests via LRT
type = 3,
control = glmerControl(optimizer = "bobyqa", optCtrl = list(maxfun = 1e5),
check.conv.grad = .makeCC("warning", tol = 0.005, relTol = NULL))
)
model_LRT
# Make the output DF better and Print it #
model_df <- broom.mixed::tidy(model_glm,effects='fixed') %>% as.data.frame()
model_df <- model_df[-1]
model_df %<>% cbind(.,exp(model_CIs))
model_df %<>%  tibble::add_column('Odds Scale'= exp(model_df$estimate), .after = 2)
# CI's #
model_CIs <- lme4::confint.merMod(model_glm, method = 'Wald', parm = 'beta_')
model_CIs
model_df
# Make the output DF better and Print it #
model_df <- broom.mixed::tidy(model_glm,effects='fixed') %>% as.data.frame()
model_df <- model_df[-1]
model_df %<>% cbind(.,exp(model_CIs))
model_df %<>%  tibble::add_column('Odds Scale'= exp(model_df$estimate), .after = 2)
model_df$term %<>% gsub("CondShort","",.)
model_df$term %<>% gsub("_michelson_c","",.)
rownames(model_df) <- model_df$term
model_df <- model_df[-1]
newCols <- c('Est.','Odds','SE','z','p','2.5\\%','97.5\\%')
colnames(model_df) <- newCols
for (col in colnames(model_df)){
model_df[[col]] %<>% sprintf("%.2e",.)
}
model_df
model_TC <- lmer(
data = dfFull,
formula = "TC_michelson_c ~ WidthGroup*ExpectedGroup + (1|Participant_Number)",
weights = weights
)
model_EM <- emmeans::emmeans(model_TC, specs = ~ExpectedGroup*WidthGroup, type = 'response', pbkrtest.limit = 5584)
1e4
model_EM <- emmeans::emmeans(model_TC, specs = ~ExpectedGroup*WidthGroup, type = 'response', pbkrtest.limit = 1e5)
AnovaTC <- Anova(model_TC,type=3)
EM_pairs <- pairs(model_EM)
EM_pairs_df <- EM_pairs %>% as.data.frame()
AnovaTC
cV <- viridis(2, option = 'viridis')
colorPalette <- c('high' = cV[1], 'low' = cV[2])
colorPalette <- c('high' = 'firebrick', 'low' = 'dodgerblue')
palette3Way <- viridis(conds %>% length())
palette3Way %<>% setNames(.,conds)
ggplot(data = dfFull,
mapping = aes(x = TC_michelson, color = ExpectedGroup)
) + geom_line(
mapping = aes(y = probability, linetype = WidthGroup),
linewidth = 1.0
) + geom_jitter(
mapping = aes(y = performance, shape = WidthGroup),
alpha = I(.1),
size = I(.7),
height = 0.05,
width = NULL,
show.legend = FALSE
) + scale_x_continuous(
transform = 'log10'
) + scale_linetype_manual(
name = 'Conditions',
values = c(
'controls' = 'solid',
'narrow' = 'twodash',
'wide' = 'dotted'
),
labels = c('Controls','Narrow','Wide')
) + scale_color_manual(
values = colorPalette,
name = "Contrast",
labels = c('Increasing', 'Decreasing')
) + xlab(
'Target Contrast'
) + ylab(
'Probability of Detection'
) + theme_pubr(
) + theme(
legend.title = element_text(hjust = .5, vjust = .5),
text = element_text(size=16,family='times'),
legend.position = 'right'
)
ggplot(
data = dfOverallMean,
mapping = aes(x = factor(CondShort, c('Constant','IN','IW','Single','DN','DW')),
y = overall_mean, group = WidthGroup, linetype = WidthGroup)
) + stat_summary(
mapping = aes(color = ExpectedGroup, shape = WidthGroup),
geom = 'point',
fun = 'mean',
size = I(5),
) + stat_summary(
geom = 'errorbar',
fun.data = mean_cl_normal,
position = position_dodge(width = 0.9),
width = 0.2,
linetype = I('solid')
) + scale_color_manual(
values = colorPalette,
name = "Contrast",
labels = c('Increasing', 'Decreasing')
) + scale_shape_manual(
name = 'Conditions',
values = c(
'controls' = 15,
'narrow' = 16,
'wide' = 17),
labels = c('Controls','Narrow','Wide')
) + scale_x_discrete(
labels = c('Constant','IN','IW','Single','DN','DW')
) + theme_pubr(
) + theme(
legend.title = element_text(hjust = .5, vjust = .5),
text = element_text(size=16,family='times'),
legend.position = 'right'
) + ylab(
"Mean Target Contrast"
) + xlab(
"Condition"
)
model3way <- lmer(
data = dfFull,
formula = "Correct_Response ~ TC_factor * WidthGroup * ExpectedGroup + (1|Participant_Number)",
)
anova3way <- Anova(model3way,type = 3)
model_EMx3 <- emmeans::emmeans(model3way, specs = ~ExpectedGroup*WidthGroup|TC_factor,
type = 'response', pbkrtest.limit = 5584)
EM_pairs_x3 <- pairs(model_EMx3)
EM_pairs_df_x3 <- EM_pairs_x3 %>% as.data.frame()
EM_signif_df_x3 <- subset(EM_pairs_df_x3, p.value <= .05)
model3way <- lmer(
data = dfFull,
formula = "Correct_Response ~ TC_factor * WidthGroup * ExpectedGroup + (1|Participant_Number)",
)
anova3way <- Anova(model3way,type = 3)
model_EMx3 <- emmeans::emmeans(model3way, specs = ~ExpectedGroup*WidthGroup|TC_factor,
type = 'response', pbkrtest.limit = 1e5)
EM_pairs_x3 <- pairs(model_EMx3)
EM_pairs_df_x3 <- EM_pairs_x3 %>% as.data.frame()
EM_signif_df_x3 <- subset(EM_pairs_df_x3, p.value <= .05)
ggplot(
data = dfMean,
mapping = aes(
x = factor(TC_factor,c('Low','Medium','High')), y = mean,
color = ExpectedGroup, shape = WidthGroup,
group = interaction(ExpectedGroup,WidthGroup))) +
stat_summary(
geom = 'point',
fun.data = mean_cl_normal,
position = position_dodge(.75),
size = I(5),) +
stat_summary(
geom = 'errorbar',
fun.data = mean_cl_normal,
position = position_dodge(.75),
width = 0.2,
linetype = I('solid'),
color = 'black') +
scale_color_manual(
values = colorPalette,
labels = c('Increasing','Decreasing'),
name = 'Contrast') +
scale_shape_manual(
values = list(
'controls' = 15,
'narrow' = 16,
'wide' = 17),
labels = c('Controls','Narrow','Wide'),
name = 'Condition') +
theme_pubr() +
theme(
legend.position = 'right',
legend.title = element_text(hjust = .5, vjust = .5),
text = element_text(family = 'times', size = 16)) +
xlab('Target Contrast') + ylab('Mean Response Rate') +
guides(
color = guide_legend(order = 1),
shape = guide_legend(order = 2))
subset(dfFull,TC_factor == 'High', select = TC_michelson_c) %>% unique()
subset(dfFull,TC_factor == 'Medium', select = TC_michelson_c) %>% unique()
subset(dfFull,TC_factor == 'Low', select = TC_michelson_c) %>% unique()
subset(dfMean,TC_factor == 'Low', select = mean) %>% unique()
save.image("RData7LS.RData")
